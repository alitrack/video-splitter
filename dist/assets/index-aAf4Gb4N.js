import{r as m,c as le,R as X}from"./vendor-BTWMFwqw.js";import{L as Z,T as de,R as G,C as y,a as k,I as H,B as w,s as o,b as S,c as K,d as T,e as j,f as ue,g as he,h as Y,i as M,D as pe,S as F,P as fe,j as me,k as xe}from"./antd-BYP7Ymws.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&c(h)}).observe(document,{childList:!0,subtree:!0});function n(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(i){if(i.ep)return;i.ep=!0;const d=n(i);fetch(i.href,d)}})();var ee={exports:{}},R={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ge=m,ye=Symbol.for("react.element"),je=Symbol.for("react.fragment"),ve=Object.prototype.hasOwnProperty,we=ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_e={key:!0,ref:!0,__self:!0,__source:!0};function re(l,s,n){var c,i={},d=null,h=null;n!==void 0&&(d=""+n),s.key!==void 0&&(d=""+s.key),s.ref!==void 0&&(h=s.ref);for(c in s)ve.call(s,c)&&!_e.hasOwnProperty(c)&&(i[c]=s[c]);if(l&&l.defaultProps)for(c in s=l.defaultProps,s)i[c]===void 0&&(i[c]=s[c]);return{$$typeof:ye,type:l,key:d,ref:h,props:i,_owner:we.current}}R.Fragment=je;R.jsx=re;R.jsxs=re;ee.exports=R;var e=ee.exports,D={},J=le;D.createRoot=J.createRoot,D.hydrateRoot=J.hydrateRoot;async function p(l,s={},n){return window.__TAURI_INTERNALS__.invoke(l,s,n)}class v{static async getFilePath(s){try{return null}catch(n){return console.error("获取文件路径失败:",n),null}}static async getVideoInfo(s){try{return await p("get_video_info",{path:s})}catch(n){throw console.error("获取视频信息失败:",n),new Error("获取视频信息失败")}}static async splitVideo(s){try{return await p("split_video",{request:s})}catch(n){throw console.error("视频分割失败:",n),new Error("视频分割失败")}}static async detectScenes(s,n=.3){try{return await p("detect_scenes",{video_path:s,threshold:n,min_duration:2})}catch(c){throw console.error("场景检测失败:",c),new Error("场景检测失败")}}static async selectVideoFile(){try{return await p("select_video_file")}catch(s){return console.error("选择文件失败:",s),null}}static async selectOutputDirectory(){try{return await p("select_output_directory")}catch(s){return console.error("选择输出目录失败:",s),null}}static async openFile(s){try{await p("open_file_explorer",{path:s})}catch(n){throw console.error("打开文件失败:",n),new Error("打开文件失败")}}static async showInFolder(s){try{await p("open_file_explorer",{path:s})}catch(n){throw console.error("显示文件失败:",n),new Error("显示文件失败")}}static async fileExists(s){try{return await p("file_exists",{path:s})}catch(n){return console.error("检查文件存在失败:",n),!1}}static async createDirectory(s){try{return await p("create_directory",{path:s})}catch(n){return console.error("创建目录失败:",n),!1}}static async getFileSize(s){try{return await p("get_file_size",{path:s})}catch(n){return console.error("获取文件大小失败:",n),0}}static async deleteFile(s){try{return await p("delete_file",{path:s})}catch(n){return console.error("删除文件失败:",n),!1}}static async getVideoThumbnail(s,n,c){try{return await p("get_video_thumbnail",{video_path:s,time_seconds:n,output_path:c})}catch(i){throw console.error("获取视频缩略图失败:",i),new Error("获取视频缩略图失败")}}static async checkSystemRequirements(){try{return await p("check_system_requirements")}catch(s){throw console.error("检查系统要求失败:",s),new Error("检查系统要求失败")}}static async getCpuUsage(){try{return await p("get_cpu_usage")}catch(s){return console.error("获取CPU使用率失败:",s),0}}static async getMemoryUsage(){try{return await p("get_memory_usage")}catch(s){return console.error("获取内存使用率失败:",s),[0,0]}}}const B=l=>{const s=Math.floor(l/3600),n=Math.floor(l%3600/60),c=Math.floor(l%60);return s>0?`${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`:`${n.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`},Q=l=>{const s=["B","KB","MB","GB","TB"];if(l===0)return"0 B";const n=Math.floor(Math.log(l)/Math.log(1024));return Math.round(l/Math.pow(1024,n)*100)/100+" "+s[n]},{Header:be,Content:Se}=Z,{Title:f,Paragraph:N}=de,Fe=()=>{const[l,s]=m.useState(null),[n,c]=m.useState(null),[i,d]=m.useState(""),[h,O]=m.useState("time"),[u,_]=m.useState({duration:60,count:0,sceneThreshold:.3,manualPoints:[]}),[I,z]=m.useState(null),[V,se]=m.useState([]),[E,C]=m.useState(!1),[L,b]=m.useState(""),[$,A]=m.useState(!0),[U,te]=m.useState([]);X.useEffect(()=>{(async()=>{try{A(!0)}catch{A(!1),o.error("FFmpeg未安装，请先安装FFmpeg")}})()},[]);const ne=async r=>{var W;console.log("拖拽文件选择:",r);const t=["video/mp4","video/avi","video/quicktime","video/x-msvideo","video/x-matroska","video/webm"],a=r.type,x=(W=r.name.split(".").pop())==null?void 0:W.toLowerCase(),g=["mp4","avi","mov","mkv","wmv","flv","webm"];if(!t.includes(a)&&!g.includes(x||""))return o.error(`不支持的视频格式：${x||a}。支持的格式：${g.join(", ")}`),!1;const P=10*1024*1024*1024;return r.size>P?(o.error("文件过大，请选择小于10GB的视频文件"),!1):(s(r),o.success(`拖拽文件已验证：${r.name} (${Q(r.size)})`),o.info('请点击"选择文件路径"按钮来设置完整的文件路径'),!1)},oe=async()=>{if(!i){o.error("请先输入视频文件路径并获取信息");return}if(!$){o.error("FFmpeg未安装，无法进行视频分割");return}let r=L;if(!r)try{const t=await v.selectOutputDirectory();if(!t){o.error("请选择输出目录");return}r=t,b(r)}catch{o.error("请手动输入输出目录路径");return}C(!0),z({current:0,total:100,message:"正在分割视频...",percentage:0});try{let t;switch(h){case"time":if(u.duration<=0)throw new Error("分割时长必须大于0");t={time:{duration:u.duration,count:u.count||void 0}};break;case"scenes":if(u.sceneThreshold<.1||u.sceneThreshold>1)throw new Error("场景阈值必须在0.1到1.0之间");t={scenes:{threshold:u.sceneThreshold,min_duration:2}};break;case"manual":if(u.manualPoints.length===0)throw new Error("请至少添加一个分割点");t={manual:{split_points:u.manualPoints}};break;default:throw new Error("不支持的分割类型")}const a={video_path:i,output_dir:r,output_format:"mp4",split_type:t},x=await v.splitVideo(a);if(x.success){const g=x.output_files.map(P=>({filename:P.split("/").pop()||"unknown",filepath:P}));se(g),o.success(`视频分割完成！生成了 ${g.length} 个片段，耗时 ${x.processing_time.toFixed(2)} 秒`)}else throw new Error(x.errors.join(", "))}catch(t){const a=t.message;o.error("分割失败："+a),a.includes("FFmpeg")?o.error("请确保FFmpeg正确安装并配置"):a.includes("file not found")?o.error("视频文件不存在或无法访问"):a.includes("permission")?o.error("没有足够的权限访问文件或目录"):a.includes("format")&&o.error("不支持的视频格式")}finally{C(!1),z(null)}},ie=async r=>{try{if(!await q(r)){o.error("文件不存在或已被移动");return}await v.openFile(r),o.success("文件已打开")}catch(t){const a=t.message;o.error("打开文件失败："+a),a.includes("not found")?o.error("文件不存在，请检查文件路径"):a.includes("permission")&&o.error("没有权限访问该文件")}},ae=async r=>{try{if(!await q(r)){o.error("文件不存在或已被移动");return}await v.showInFolder(r),o.success("已在文件夹中显示")}catch(t){const a=t.message;o.error("显示文件失败："+a),a.includes("not found")?o.error("文件不存在，请检查文件路径"):a.includes("permission")&&o.error("没有权限访问该文件夹")}},q=async r=>{try{return await v.fileExists(r)}catch{return!1}},ce=async()=>{if(!i){o.error("请先选择视频文件");return}if(h==="scenes"){C(!0);try{const r=await v.detectScenes(i,u.sceneThreshold);te(r);const t=r.map(a=>a.time);_(a=>({...a,manualPoints:t})),o.success(`检测到 ${r.length} 个场景变化点`)}catch(r){o.error("场景检测失败："+r.message)}finally{C(!1)}}else if(h==="time"){const r=(n==null?void 0:n.duration)||0,t=u.duration,a=u.count||Math.ceil(r/t),x=[];for(let g=1;g<a;g++)x.push(g*t);_(g=>({...g,manualPoints:x})),o.success(`生成了 ${x.length} 个时间分割点`)}else o.info("请先选择分割类型")};return e.jsxs(Z,{className:"app",children:[e.jsxs(be,{className:"header",children:[e.jsxs(f,{level:1,style:{color:"white",margin:0},children:[e.jsx(G,{})," 视频分割工具"]}),e.jsx(N,{style:{color:"white",margin:"8px 0 0 0"},children:"专业视频分割工具 - 支持场景检测、时间分割、手动分割"})]}),e.jsxs(Se,{className:"main-container",children:[!$&&e.jsxs(y,{className:"warning-card",style:{marginBottom:"16px",backgroundColor:"#fff2f0",borderColor:"#ffccc7"},children:[e.jsx(f,{level:4,style:{color:"#cf1322"},children:"⚠️ FFmpeg未安装"}),e.jsxs(N,{style:{color:"#cf1322"},children:["请先安装FFmpeg才能使用视频分割功能。",e.jsx("br",{}),"macOS: ",e.jsx("code",{children:"brew install ffmpeg"}),e.jsx("br",{}),"Ubuntu: ",e.jsx("code",{children:"sudo apt install ffmpeg"}),e.jsx("br",{}),"Windows: 从 ",e.jsx("a",{href:"https://ffmpeg.org/download.html",target:"_blank",rel:"noopener noreferrer",children:"FFmpeg官网"})," 下载"]})]}),e.jsxs(y,{className:"upload-card",children:[e.jsxs(f,{level:2,children:[e.jsx(k,{})," 选择视频文件"]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:["视频文件路径 ",e.jsx("span",{style:{color:"#ff4d4f",fontSize:"12px"},children:"*"}),"："]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx(H,{value:i,onChange:r=>d(r.target.value),placeholder:"请输入视频文件的完整路径，或通过下方按钮选择",style:{flex:1}}),e.jsx(w,{onClick:async()=>{try{const r=await v.selectVideoFile();r&&(d(r),o.success("文件路径已选择"))}catch{o.error("选择文件路径失败")}},children:"选择文件路径"}),e.jsx(w,{type:"primary",onClick:async()=>{if(!i){o.error("请先输入视频文件路径");return}try{const r=await v.getVideoInfo(i);c(r);const t=r.path.substring(0,r.path.lastIndexOf("/"));b(t),o.success("视频信息获取成功")}catch(r){const t=r.message;o.error("获取视频信息失败："+t),t.includes("FFmpeg")?o.error("FFmpeg未正确安装或配置"):t.includes("file not found")?o.error("无法访问视频文件"):t.includes("format")&&o.error("不支持的视频格式")}},children:"获取信息"})]})]}),e.jsxs("div",{className:"custom-drag-area",style:{border:"2px dashed #d9d9d9",borderRadius:"8px",padding:"40px",textAlign:"center",cursor:"pointer",transition:"all 0.3s ease",backgroundColor:"#fafafa"},onClick:async()=>{if(!E)try{const r=await v.selectVideoFile();if(r){d(r),o.success("文件路径已选择，正在获取视频信息...");try{const t=await v.getVideoInfo(r);c(t);const a=t.path.substring(0,t.path.lastIndexOf("/"));b(a),o.success("视频信息获取成功，可以开始分割")}catch{o.error("获取视频信息失败，请检查文件路径")}}}catch{o.error("选择文件失败")}},onDragOver:r=>{r.preventDefault(),r.currentTarget.style.borderColor="#1890ff",r.currentTarget.style.backgroundColor="#e6f7ff"},onDragLeave:r=>{r.currentTarget.style.borderColor="#d9d9d9",r.currentTarget.style.backgroundColor="#fafafa"},onDrop:async r=>{if(r.preventDefault(),r.currentTarget.style.borderColor="#d9d9d9",r.currentTarget.style.backgroundColor="#fafafa",E)return;const t=r.dataTransfer.files;t.length>0&&await ne(t[0])},children:[e.jsx("p",{style:{margin:0,marginBottom:"16px"},children:e.jsx(G,{style:{fontSize:"48px",color:"#667eea"}})}),e.jsx("p",{style:{fontSize:"16px",margin:"8px 0",fontWeight:"bold"},children:"点击选择视频文件或拖拽文件到此处"}),e.jsxs("p",{style:{color:"#666",margin:"8px 0"},children:["支持 MP4, AVI, MOV, MKV 等常见视频格式",e.jsx("br",{}),"文件大小限制：10GB"]})]}),l&&e.jsxs("div",{style:{marginTop:"16px"},children:[e.jsxs(S,{color:"blue",children:[e.jsx(K,{})," ",l.name]}),e.jsx(S,{color:"green",children:Q(l.size)}),i?e.jsx(S,{color:"success",children:"文件路径已设置"}):e.jsx(S,{color:"warning",children:"请手动选择文件路径"})]})]}),n&&e.jsxs(y,{className:"info-card",children:[e.jsxs(f,{level:3,children:[e.jsx(K,{})," 视频信息"]}),e.jsxs(T,{gutter:[16,16],children:[e.jsx(j,{span:6,children:e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"label",children:"时长"}),e.jsx("div",{className:"value",children:B(n.duration)})]})}),e.jsx(j,{span:6,children:e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"label",children:"分辨率"}),e.jsxs("div",{className:"value",children:[n.width," × ",n.height]})]})}),e.jsx(j,{span:6,children:e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"label",children:"帧率"}),e.jsxs("div",{className:"value",children:[n.fps," fps"]})]})}),e.jsx(j,{span:6,children:e.jsxs("div",{className:"info-item",children:[e.jsx("div",{className:"label",children:"格式"}),e.jsx("div",{className:"value",children:n.format.toUpperCase()})]})})]})]}),n&&e.jsxs(y,{className:"split-card",children:[e.jsxs(f,{level:2,children:[e.jsx(ue,{})," 分割设置"]}),e.jsxs(T,{gutter:[16,16],style:{marginBottom:"24px"},children:[e.jsx(j,{span:8,children:e.jsxs(y,{className:`split-option ${h==="time"?"selected":""}`,onClick:()=>O("time"),hoverable:!0,children:[e.jsx(he,{style:{fontSize:"32px",marginBottom:"8px"}}),e.jsx(f,{level:4,children:"时间分割"}),e.jsx(N,{children:"按固定时长或段数分割"})]})}),e.jsx(j,{span:8,children:e.jsxs(y,{className:`split-option ${h==="scenes"?"selected":""}`,onClick:()=>O("scenes"),hoverable:!0,children:[e.jsx(Y,{style:{fontSize:"32px",marginBottom:"8px"}}),e.jsx(f,{level:4,children:"场景分割"}),e.jsx(N,{children:"智能检测场景变化"})]})}),e.jsx(j,{span:8,children:e.jsxs(y,{className:`split-option ${h==="manual"?"selected":""}`,onClick:()=>O("manual"),hoverable:!0,children:[e.jsx(k,{style:{fontSize:"32px",marginBottom:"8px"}}),e.jsx(f,{level:4,children:"手动分割"}),e.jsx(N,{children:"自定义分割点"})]})})]}),h==="time"&&e.jsxs(T,{gutter:[16,16],children:[e.jsx(j,{span:12,children:e.jsxs("div",{children:[e.jsx("label",{children:"每段时长（秒）"}),e.jsx(M,{min:1,max:(n==null?void 0:n.duration)||3600,value:u.duration,onChange:r=>_(t=>({...t,duration:r||60})),style:{width:"100%"}})]})}),e.jsx(j,{span:12,children:e.jsxs("div",{children:[e.jsx("label",{children:"分割段数"}),e.jsx(M,{min:1,max:100,value:u.count,onChange:r=>_(t=>({...t,count:r||0})),placeholder:"留空则按时长分割",style:{width:"100%"}})]})})]}),h==="scenes"&&e.jsx(T,{gutter:[16,16],children:e.jsx(j,{span:12,children:e.jsxs("div",{children:[e.jsx("label",{children:"场景变化阈值"}),e.jsx(M,{min:.1,max:1,step:.1,value:u.sceneThreshold,onChange:r=>_(t=>({...t,sceneThreshold:r||.3})),style:{width:"100%"}})]})})}),e.jsx(pe,{}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{children:"输出目录："}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"8px"},children:[e.jsx(H,{value:L,onChange:r=>b(r.target.value),placeholder:"输入输出目录的完整路径",style:{flex:1}}),e.jsx(w,{onClick:()=>{if(i){const r=i.substring(0,i.lastIndexOf("/"));b(r),o.success("已设置默认输出目录")}else o.error("请先选择视频文件")},children:"默认目录"})]})]}),e.jsxs(F,{children:[e.jsx(w,{type:"primary",size:"large",onClick:oe,loading:E,disabled:!n||!$,icon:e.jsx(k,{}),children:"开始分割"}),e.jsx(w,{size:"large",disabled:!n,onClick:ce,loading:E,children:"预览分割点"})]})]}),I&&e.jsxs(y,{className:"progress-card",children:[e.jsx(f,{level:3,children:"分割进度"}),e.jsx(fe,{percent:Math.round(I.percentage),status:"active"}),e.jsx("div",{style:{marginTop:"8px",color:"#666"},children:I.message})]}),U.length>0&&e.jsxs(y,{className:"scenes-card",children:[e.jsxs(f,{level:3,children:[e.jsx(Y,{})," 检测到的场景点"]}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto"},children:e.jsx(F,{direction:"vertical",style:{width:"100%"},children:U.map((r,t)=>e.jsxs("div",{className:"scene-item",children:[e.jsx("span",{children:B(r.time)}),e.jsxs(S,{color:"blue",children:["置信度: ",(r.confidence*100).toFixed(1),"%"]})]},t))})})]}),u.manualPoints.length>0&&e.jsxs(y,{className:"manual-points-card",children:[e.jsxs(f,{level:3,children:[e.jsx(k,{})," 分割点预览"]}),e.jsx("div",{style:{maxHeight:"150px",overflowY:"auto"},children:e.jsx(F,{direction:"vertical",style:{width:"100%"},children:u.manualPoints.map((r,t)=>e.jsx("div",{className:"manual-point-item",children:e.jsxs("span",{children:["分割点 ",t+1,": ",B(r)]})},t))})})]}),V.length>0&&e.jsxs(y,{className:"results-card",children:[e.jsx(f,{level:3,children:"分割结果"}),e.jsx(F,{direction:"vertical",style:{width:"100%"},children:V.map((r,t)=>e.jsxs("div",{className:"result-item",children:[e.jsx("span",{children:r.filename}),e.jsxs(F,{children:[e.jsx(w,{type:"link",size:"small",icon:e.jsx(me,{}),onClick:()=>ie(r.filepath),children:"下载"}),e.jsx(w,{type:"link",size:"small",icon:e.jsx(xe,{}),onClick:()=>ae(r.filepath),children:"打开文件夹"})]})]},t))})]})]})]})},Ne=D.createRoot(document.getElementById("root"));Ne.render(e.jsx(X.StrictMode,{children:e.jsx(Fe,{})}));
